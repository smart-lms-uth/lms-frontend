<aside class="course-sidebar" [class.course-sidebar--open]="isOpen">
  <div class="sidebar-header">
    <h3 class="sidebar-title">Nội dung khóa học</h3>
    <button class="sidebar-close" (click)="onClose()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="sidebar-content">
    <div *ngIf="isLoading" class="sidebar-loading">
      <div class="spinner-small"></div>
      <span>Đang tải...</span>
    </div>

    <ul class="section-list" *ngIf="!isLoading && sections.length > 0">
      <li *ngFor="let sec of sections; let i = index; trackBy: trackBySection"
          class="section-item"
          [class.section-item--expanded]="isExpanded(sec.id)"
          [class.section-item--active]="isActive(sec.id)"
          [class.section-item--hidden]="!sec.visible">
        <div class="section-header">
          <div class="section-info" (click)="onSectionClick(sec)">
            <span class="section-number">{{ i + 1 }}</span>
            <span class="section-title">{{ sec.title }}</span>
            <span *ngIf="!sec.visible" class="hidden-badge">Ẩn</span>
          </div>
          <button class="section-toggle-btn" (click)="onSectionToggle(sec.id, $event)">
            <svg class="section-arrow" [class.rotated]="isExpanded(sec.id)" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
        </div>

        <div class="section-modules" *ngIf="isExpanded(sec.id)">
          <ng-container *ngIf="sec.modules && sec.modules.length > 0">
            <div class="sidebar-module-list">
              <div *ngFor="let module of sec.modules; trackBy: trackByModule"
                   class="sidebar-module-item"
                   [class.sidebar-module-item--completed]="module.isCompleted">
                <span class="sidebar-module-icon">
                  <ng-container [ngSwitch]="module.type">
                    <svg *ngSwitchCase="'VIDEO'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    <svg *ngSwitchCase="'RESOURCE'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                    <svg *ngSwitchCase="'QUIZ'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path></svg>
                    <svg *ngSwitchCase="'ASSIGNMENT'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                    <svg *ngSwitchCase="'LIVESTREAM'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                    <svg *ngSwitchCase="'FORUM'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                  </ng-container>
                </span>
                <span class="sidebar-module-title">{{ module.title }}</span>
              </div>
            </div>
          </ng-container>

          <p *ngIf="!sec.modules || sec.modules.length === 0" class="sidebar-empty-modules">Chưa có module</p>

          <button class="sidebar-go-section-btn" (click)="onSectionClick(sec); $event.stopPropagation()">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            Xem chi tiết
          </button>
        </div>
      </li>
    </ul>
  </div>
</aside>
