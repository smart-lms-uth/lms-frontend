<app-main-layout (logoutClicked)="logout()">
  <div class="dashboard">
    <!-- Breadcrumb -->
    <div class="page-header">
      <nav class="breadcrumb">
        <span class="breadcrumb-item breadcrumb-item--current">
          <svg class="breadcrumb-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          Dashboard
        </span>
      </nav>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading()" class="loading-container">
      <div class="spinner"></div>
      <p>Đang tải dữ liệu...</p>
    </div>

    <div *ngIf="!loading()" class="main-content">
      <!-- My Courses Section - Grid Cards -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
            Lớp học phần của tôi
          </h2>
          <button class="btn btn--primary btn--sm" routerLink="/teacher/courses/create">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Thêm khóa học
          </button>
        </div>

        <div class="courses-grid" *ngIf="myCourses().length > 0">
          <div *ngFor="let course of myCourses(); let i = index" class="course-card" (click)="viewCourse(course)">
            <div class="course-card__thumbnail" [class]="'course-card__thumbnail--color-' + (i % 8)">
              <div class="course-card__pattern" [class]="'course-card__pattern--' + (i % 5)"></div>
              <div class="course-card__overlay">
                <span class="course-card__code">{{ course.subjectCode }}</span>
              </div>
            </div>
            <div class="course-card__content">
              <h3 class="course-card__title">{{ course.subjectName }}</h3>
              <p class="course-card__info">Mã khóa: <strong>{{ course.courseCode }}</strong></p>
              <div class="course-card__meta">
                <app-badge [variant]="courseService.getStatusVariant(course.status)" size="sm">
                  {{ courseService.getStatusLabel(course.status) }}
                </app-badge>
                <span class="course-card__students">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                  </svg>
                  {{ course.currentEnrollment }}/{{ course.maxStudents }}
                </span>
              </div>
            </div>
            <button class="course-card__menu" (click)="openCourseMenu($event, course)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="12" cy="5" r="1"/>
                <circle cx="12" cy="19" r="1"/>
              </svg>
            </button>
          </div>
        </div>

        <div *ngIf="myCourses().length === 0" class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          <h3>Chưa có lớp học phần nào</h3>
          <p>Bắt đầu tạo lớp học phần đầu tiên của bạn</p>
          <button class="btn btn--primary" routerLink="/teacher/courses/create">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Tạo lớp học phần
          </button>
        </div>
      </section>

      <!-- Subjects Section - Grid Cards -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
            Danh mục môn học
          </h2>
        </div>

        <div class="subjects-grid">
          <div *ngFor="let subject of subjects()" class="subject-card">
            <div class="subject-card__thumbnail" [class]="'subject-card__thumbnail--' + getSubjectColor(subject.subjectCode)">
              <span class="subject-card__icon">{{ subject.subjectCode.substring(0, 2) }}</span>
            </div>
            <div class="subject-card__content">
              <h3 class="subject-card__title">{{ subject.name }}</h3>
              <p class="subject-card__code">{{ subject.subjectCode }}</p>
              <div class="subject-card__meta">
                <span class="subject-card__credits">{{ subject.credits }} tín chỉ</span>
                <span class="subject-card__department">{{ subject.department }}</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bottom Section - Semester + Quick Actions -->
      <div class="bottom-grid">
        <!-- Current Semester -->
        <div class="info-card">
          <div class="info-card__header">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <span>Học kỳ hiện tại</span>
          </div>
          <div class="info-card__content" *ngIf="currentSemester()">
            <h3 class="info-card__title">{{ currentSemester()!.displayName }}</h3>
            <p class="info-card__dates">
              {{ formatDate(currentSemester()!.startDate) }} → {{ formatDate(currentSemester()!.endDate) }}
            </p>
            <app-badge variant="success" size="sm">Đang diễn ra</app-badge>
          </div>
        </div>

        <!-- Stats Summary -->
        <div class="info-card">
          <div class="info-card__header">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="20" x2="18" y2="10"/>
              <line x1="12" y1="20" x2="12" y2="4"/>
              <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
            <span>Thống kê</span>
          </div>
          <div class="stats-list">
            <div class="stat-row">
              <span class="stat-row__label">Lớp học phần</span>
              <span class="stat-row__value">{{ myCourses().length }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-row__label">Môn học</span>
              <span class="stat-row__value">{{ subjects().length }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-row__label">Tổng sinh viên</span>
              <span class="stat-row__value">{{ totalStudents() }}</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="info-card">
          <div class="info-card__header">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
            <span>Thao tác nhanh</span>
          </div>
          <div class="quick-actions">
            <button class="quick-action" routerLink="/teacher/courses/create">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14M5 12h14"/>
              </svg>
              Tạo lớp học phần
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-main-layout>
