<app-main-layout (logoutClicked)="logout()">
  <div class="form-page">
    <!-- Page Header -->
    <div class="page-header">
      <a routerLink="/teacher/courses" class="back-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Quay lại
      </a>
      <h1 class="page-header__title">{{ isEdit() ? 'Chỉnh sửa lớp học phần' : 'Tạo lớp học phần mới' }}</h1>
      <p class="page-header__subtitle">
        {{ isEdit() ? 'Cập nhật thông tin lớp học phần' : 'Điền thông tin để tạo lớp học phần mới' }}
      </p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading()" class="loading-container">
      <div class="spinner"></div>
      <p>Đang tải dữ liệu...</p>
    </div>

    <!-- Form -->
    <form *ngIf="!loading()" [formGroup]="courseForm" (ngSubmit)="onSubmit()" class="course-form">
      <app-card variant="default" [showFooter]="true">
        <div card-header>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          <span>Thông tin lớp học phần</span>
        </div>

        <div class="form-grid">
          <!-- Course Code -->
          <div class="form-group">
            <label class="form-label" for="courseCode">
              Mã lớp học phần <span class="required">*</span>
            </label>
            <input
              type="text"
              id="courseCode"
              class="form-input"
              formControlName="courseCode"
              placeholder="VD: CS101-01-HK1"
              [class.form-input--error]="isFieldInvalid('courseCode')">
            <p class="form-error" *ngIf="isFieldInvalid('courseCode')">
              Mã lớp học phần không được để trống
            </p>
          </div>

          <!-- Subject -->
          <div class="form-group">
            <label class="form-label" for="subjectId">
              Môn học <span class="required">*</span>
            </label>
            <select
              id="subjectId"
              class="form-select"
              formControlName="subjectId"
              [class.form-input--error]="isFieldInvalid('subjectId')">
              <option value="">Chọn môn học</option>
              <option *ngFor="let subject of subjects()" [value]="subject.id">
                {{ subject.subjectCode }} - {{ subject.name }} ({{ subject.credits }} TC)
              </option>
            </select>
            <p class="form-error" *ngIf="isFieldInvalid('subjectId')">
              Vui lòng chọn môn học
            </p>
          </div>

          <!-- Semester -->
          <div class="form-group">
            <label class="form-label" for="semesterId">
              Học kỳ <span class="required">*</span>
            </label>
            <select
              id="semesterId"
              class="form-select"
              formControlName="semesterId"
              [class.form-input--error]="isFieldInvalid('semesterId')">
              <option value="">Chọn học kỳ</option>
              <option *ngFor="let semester of semesters()" [value]="semester.id">
                {{ semester.displayName }} {{ semester.isCurrent ? '(Hiện tại)' : '' }}
              </option>
            </select>
            <p class="form-error" *ngIf="isFieldInvalid('semesterId')">
              Vui lòng chọn học kỳ
            </p>
          </div>

          <!-- Room -->
          <div class="form-group">
            <label class="form-label" for="room">Phòng học</label>
            <input
              type="text"
              id="room"
              class="form-input"
              formControlName="room"
              placeholder="VD: B201">
          </div>

          <!-- Max Students -->
          <div class="form-group">
            <label class="form-label" for="maxStudents">
              Sĩ số tối đa <span class="required">*</span>
            </label>
            <input
              type="number"
              id="maxStudents"
              class="form-input"
              formControlName="maxStudents"
              placeholder="50"
              min="1"
              [class.form-input--error]="isFieldInvalid('maxStudents')">
            <p class="form-error" *ngIf="isFieldInvalid('maxStudents')">
              Sĩ số tối đa phải lớn hơn 0
            </p>
          </div>

          <!-- Status -->
          <div class="form-group">
            <label class="form-label" for="status">
              Trạng thái <span class="required">*</span>
            </label>
            <select
              id="status"
              class="form-select"
              formControlName="status"
              [class.form-input--error]="isFieldInvalid('status')">
              <option value="">Chọn trạng thái</option>
              <option value="PLANNED">Đã lên kế hoạch</option>
              <option value="OPEN">Đang mở đăng ký</option>
              <option value="CLOSED">Đã đóng đăng ký</option>
              <option value="IN_PROGRESS">Đang diễn ra</option>
            </select>
            <p class="form-error" *ngIf="isFieldInvalid('status')">
              Vui lòng chọn trạng thái
            </p>
          </div>
        </div>

        <div card-footer>
          <div class="form-actions">
            <button type="button" class="btn btn--outline" routerLink="/teacher/courses">
              Hủy
            </button>
            <button type="submit" class="btn btn--primary" [disabled]="submitting()">
              <span *ngIf="!submitting()">
                {{ isEdit() ? 'Cập nhật' : 'Tạo lớp học phần' }}
              </span>
              <span *ngIf="submitting()">Đang xử lý...</span>
            </button>
          </div>
        </div>
      </app-card>
    </form>

    <!-- Error Message -->
    <div *ngIf="errorMessage()" class="error-banner">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      <span>{{ errorMessage() }}</span>
    </div>
  </div>
</app-main-layout>
